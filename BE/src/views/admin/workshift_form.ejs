

<form action="<%= formAction %>" method="POST" class="space-y-4 bg-white p-6 rounded shadow">
  <% if (method === 'PATCH') { %>
    <input type="hidden" name="_method" value="PATCH">
  <% } %>

  <!-- Dropdown chọn thợ -->
  <div>
    <label class="block mb-1 font-medium">Chọn thợ sửa xe</label>
    <select name="mechanic_id" required class="border p-2 rounded w-full focus:ring focus:ring-emerald-200">
      <option value="">-- Chọn thợ --</option>
      <% mechanics.forEach(m => { %>
        <option value="<%= m.id %>" <%= workshift?.mechanic_id === m.id ? 'selected' : '' %>>
          <%= m.Acc?.name || ('Thợ #' + m.id) %>
        </option>
      <% }) %>
    </select>
  </div>

  <!-- Ngày làm việc -->
  <div>
    <label class="block mb-1 font-medium">Ngày làm việc</label>
    <input type="date" name="work_date" value="<%= workshift?.work_date || '' %>"
           required class="border p-2 rounded w-full focus:ring focus:ring-emerald-200">
  </div>

  <!-- Giờ bắt đầu -->
  <div>
    <label class="block mb-1 font-medium">Giờ bắt đầu</label>
    <input type="time" name="start_time" value="<%= workshift ? 
        String(Math.floor(workshift.start_min / 60)).padStart(2,'0') + ':' + 
        String(workshift.start_min % 60).padStart(2,'0') : '' %>"
        required class="border p-2 rounded w-full focus:ring focus:ring-emerald-200">
  </div>

  <!-- Giờ kết thúc -->
  <div>
    <label class="block mb-1 font-medium">Giờ kết thúc</label>
    <input type="time" name="end_time" value="<%= workshift ? 
        String(Math.floor(workshift.end_min / 60)).padStart(2,'0') + ':' + 
        String(workshift.end_min % 60).padStart(2,'0') : '' %>"
        required class="border p-2 rounded w-full focus:ring focus:ring-emerald-200">
  </div>

  <!-- Step -->
  <div>
    <label class="block mb-1 font-medium">Khoảng thời gian (phút / step)</label>
    <input type="number" name="step_min" min="5" max="120" step="5"
           value="<%= workshift?.step_min || 15 %>"
           required class="border p-2 rounded w-full focus:ring focus:ring-emerald-200">
  </div>

  <div class="flex gap-3 mt-6">
    <button type="submit"
            class="bg-emerald-600 text-white px-4 py-2 rounded hover:bg-emerald-700">
      Lưu ca làm
    </button>
    <a href="/admin/workshifts" class="px-4 py-2 rounded border hover:bg-slate-100">Hủy</a>
  </div>
</form>

<script>
  // Chuyển đổi HH:MM -> phút khi gửi form
  document.querySelector('form').addEventListener('submit', function(e) {
    const startTime = this.start_time.value.split(':');
    const endTime = this.end_time.value.split(':');
    const startMin = parseInt(startTime[0]) * 60 + parseInt(startTime[1]);
    const endMin = parseInt(endTime[0]) * 60 + parseInt(endTime[1]);

    // tạo input ẩn
    const inputStart = document.createElement('input');
    inputStart.type = 'hidden';
    inputStart.name = 'start_min';
    inputStart.value = startMin;

    const inputEnd = document.createElement('input');
    inputEnd.type = 'hidden';
    inputEnd.name = 'end_min';
    inputEnd.value = endMin;

    this.appendChild(inputStart);
    this.appendChild(inputEnd);
  });
</script>
